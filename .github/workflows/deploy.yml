# ğŸ“¦ GitHub Actions Workflow: Build Docker & Deploy Infrastructure with Terraform

name: Build Docker & Deploy Infrastructure

# âœ… Trigger this workflow on every push to the master branch
on:
  workflow_dispatch:

# ---------------------------
# ğŸ’¼ Jobs (Currently Commented)
# ---------------------------

# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest

#     env:  # ğŸŒ Centralized environment variables
#       DOCKER_IMAGE_NAME: venkatamahendrakalla/strapi-image
#       AWS_REGION: ap-south-1
#       AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
#       AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#       DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
#       DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}

#     steps:
#     - name: ğŸ”„ Checkout Code
#       uses: actions/checkout@v4

#     # -----------------------
#     # ğŸ³ Docker Build & Push
#     # -----------------------
#     - name: ğŸ” Log in to DockerHub
#       uses: docker/login-action@v3
#       with:
#         username: ${{ env.DOCKERHUB_USERNAME }}
#         password: ${{ env.DOCKERHUB_TOKEN }}

#     - name: ğŸ—ï¸ Build Docker Image
#       run: docker build -t $DOCKER_IMAGE_NAME:latest .

#     - name: ğŸš€ Push Docker Image to Docker Hub
#       run: docker push $DOCKER_IMAGE_NAME:latest

# -------------------------------
# ğŸ› ï¸ Terraform Infrastructure Automation
# -------------------------------
- name: ğŸ“¥ Setup Terraform CLI
  uses: hashicorp/setup-terraform@v3

- name: ğŸ“¦ Terraform Init
  run: terraform init
  working-directory: terraform3

- name: ğŸ§  Terraform Plan
  run: terraform plan
  working-directory: terraform3

- name: ğŸš€ Terraform Apply
  run: terraform apply --auto-approve
  working-directory: terraform3

 - name: ğŸ’¤ Wait for 15 Minutes
   run: sleep 900  # 900 seconds = 15 minutes

 - name: ğŸ’£ Terraform Destroy
   run: terraform destroy --auto-approve
   working-directory: terraform3
